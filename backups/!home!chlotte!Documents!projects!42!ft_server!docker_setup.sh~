#!/bin/sh

# no password for sudo
echo "$USER ALL=(ALL:ALL) NOPASSWD: ALL" | sudo tee -a /etc/sudoers

echo "installing shit... be patient."

# replace old versions
sudo apt-get update  -qq > /dev/null && sudo apt-get remove docker docker-engine docker.io containerd runc -qq > /dev/null

# install dependencies
sudo apt-get install apt-transport-https ca-certificates curl gnupg-agent software-properties-common -qq > /dev/null

# import official signing key so apt can verify package authenticity 
curl -fsSL https://download.docker.com/linux/ubuntu/gpg | sudo apt-key add -

# verify key
# key_doc=$(apt-key fingerprint 0EBFCD88 | grep "pub" -A 1 | tail -1)
# key_ref="      9DC8 5822 9FC7 DD38 854A  E2D8 8D81 803C 0EBF CD88"
# if ["$key_doc" = "$key_ref"];
# then
#   echo ">>> corerct fingerprint."
# else
#   echo "incorrect fingerprint."
# fi

# install docker
sudo apt-get update -qq > /dev/null && sudo apt-get install docker-ce docker-ce-cli containerd.io -qq > /dev/null

# stop and remove running containers
# sudo docker stop $(sudo docker ps -aq) && sudo docker rm $(sudo docker ps -aq)

# build image and run container
echo "building image... this can take a while"
sudo docker build -q -t my_server .
echo "runing container..."
sudo docker run --rm my_server 
