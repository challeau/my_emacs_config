#include "../inc/minirt.h"

void	write_to_image(t_rgb color, t_vec2i pixel, t_mlx_obj *mlx)
{
	int	bpp;
	int	size_line;
	int	endian;
	size_t	pos;

	mlx->img_data = mlx_get_data_addr(mlx->img_ptr, &bpp,
					  &size_line, &endian);
	pos = (pixel.y * size_line) + pixel.x * bpp / 8;
	if (endian == 0) /* least significant byte fist (blue) */
	{
		mlx->img_data[pos] = (int)color.z;
		mlx->img_data[pos + 1] = (int)color.y;
		mlx->img_data[pos + 2] = (int)color.x;
		mlx->img_data[pos + 3] = 0;
	}
	else if (endian == 1) /* most significant byte first (alpha) */
	{
		mlx->img_data[pos] = 0;
		mlx->img_data[pos + 1] = (int)color.x;
		mlx->img_data[pos + 2] = (int)color.y;
		mlx->img_data[pos + 2] = (int)color.z;
	}
}

void	handle_image(t_scene s, t_mlx_obj mlx)
{
	if (s.save_image == true)
	{
		printf("saving stuff go here\n");
	}
	else
	{
		mlx_put_image_to_window(mlx.mlx_ptr, mlx.win_ptr,
					mlx.img_ptr, 0, 0);
	}
	free(s.obj_list);
	free(s.cam_list);
	printf("main loop exited. congrats\n");
}
